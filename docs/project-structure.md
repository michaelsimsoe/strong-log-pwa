# StrongLog V1.0 Project Structure (Revised with Co-located Unit Tests)

**Version:** 0.3
**Date:** 2025-05-22
**Author:** 3 Arkitekten (AI)

### 1. Introduction

This document outlines the standard folder and file structure for the StrongLog V1.0 Progressive Web Application. A well-defined, consistent project structure is crucial for:

* **Maintainability:** Making it easier to locate code, understand its purpose, and make changes without unintended side effects.
* **Scalability:** Allowing the project to grow in an organized manner as new features are added.
* **Collaboration:** Ensuring all team members (human and AI) can navigate the codebase efficiently and contribute consistently.
* **Developer Onboarding:** Helping new developers understand the application's layout quickly.
* **AI Agent Optimization:** Providing a clear, predictable, and modular structure that AI development agents can more easily parse, understand, and generate code for.

This structure is designed for a **React (with TypeScript) PWA built using Vite**, incorporating our selected technologies like Dexie.js, Zustand, Comlink for Web Workers, and `shadcn/ui` for components.

### 2. High-Level Directory Structure (Revised for Unit Tests)

```plaintext
stronglog-pwa/
├── .github/                    # CI/CD workflows (e.g., GitHub Actions)
│   └── workflows/
│       └── deploy-pwa.yml
├── .husky/                     # Git hooks (e.g., for pre-commit linting/formatting)
│   └── _/
│   └── pre-commit
├── .vscode/                    # VSCode editor settings (launch.json, settings.json)
├── dist/                       # Build output directory (generated by Vite, git-ignored)
├── docs/                       # Project documentation (this file, PRD, Architecture, Epics, etc.)
│   ├── ... (as previously detailed)
├── public/                     # Static assets directly copied to dist root
│   ├── manifest.json           # Web App Manifest
│   ├── icons/                  # App icons
│   └── locales/                # (Optional) For i18n localization files if needed
├── scripts/                    # Utility scripts (e.g., seed-db.ts, custom build steps)
├── src/                        # Application source code
│   ├── App.tsx                 # Main application component
│   ├── main.tsx                # Application entry point
│   ├── vite-env.d.ts
│   │
│   ├── assets/
│   │
│   ├── components/
│   │   ├── layout/
│   │   │   └── Navbar.tsx
│   │   │   └── Navbar.test.tsx     # Co-located unit test
│   │   └── ui/
│   │   └── shared/
│   │
│   ├── config/
│   │
│   ├── features/
│   │   ├── workout-logging/
│   │   │   ├── components/
│   │   │   │   └── SetInputRow.tsx
│   │   │   │   └── SetInputRow.test.tsx  # Co-located unit test
│   │   │   ├── hooks/
│   │   │   │   └── useWorkoutTimer.ts
│   │   │   │   └── useWorkoutTimer.test.ts # Co-located unit test
│   │   │   ├── pages/
│   │   │   └── ...
│   │   └── ... (other feature folders with co-located tests)
│   │
│   ├── hooks/                  # Global custom React hooks
│   │   └── useDebounce.ts
│   │   └── useDebounce.test.tsx    # Co-located unit test
│   │
│   ├── lib/                    # Global utility functions
│   │
│   ├── pages/                  # (If not co-located in features/)
│   │
│   ├── services/
│   │   ├── data/
│   │   │   └── db.ts
│   │   │   └── db.test.ts          # Co-located unit test for DAL aspects
│   │   ├── engines/
│   │   │   ├── frx.worker.ts
│   │   │   ├── frx/
│   │   │   │   └── frxRuleEvaluator.ts
│   │   │   │   └── frxRuleEvaluator.test.ts # Co-located unit test
│   │   │   └── ...
│   │   └── sync/
│   │
│   ├── state/
│   │   └── uiStore.ts
│   │   └── uiStore.test.ts         # Co-located unit test
│   │
│   ├── styles/
│   │
│   └── types/
│
├── tests/                      # Automated tests (excluding co-located unit tests)
│   ├── e2e/                    # End-to-end tests (Playwright)
│   │   └── example.spec.ts
│   ├── integration/            # Integration tests (Vitest)
│   │   └── features/
│   │       └── workout-logging/
│   │           └── LoggingFlow.integration.test.ts
│   ├── mocks/                  # Global mocks for testing (e.g., API mocks, worker mocks)
│   └── setup/                  # Test setup files (e.g., Vitest global setup, RTL setup)
│
├── .editorconfig
├── .eslintrc.cjs
├── .gitignore
├── .lintstagedrc.cjs
├── .prettierrc.cjs
├── index.html
├── package.json
├── pnpm-lock.yaml
├── postcss.config.cjs
├── tailwind.config.cjs
├── tsconfig.json
├── tsconfig.node.json
└── vite.config.ts
```

---

### 3. Key Top-Level Directory Descriptions

* **`.github/workflows/`**: Contains CI/CD pipeline configurations using GitHub Actions for automated testing, building, and deployment of the PWA.
* **`.husky/`**: Manages Git hooks (e.g., using Husky) to enforce code quality standards (linting, formatting, running tests) before commits or pushes.
* **`dist/`**: The output directory for production builds generated by Vite. This directory is git-ignored as it's a build artifact.
* **`docs/`**: All project planning, architectural, and reference documentation resides here.
* **`public/`**: Static assets that are copied directly to the `dist` root during the build process. This includes the `manifest.json` for PWA installability, app icons, and potentially other assets like `robots.txt` or global font files not imported via CSS.
* **`scripts/`**: Utility and helper scripts for development, such as database seeding (e.g., initial exercises), custom build processes, or deployment helpers.
* **`src/`**: Contains all the application's source code.
* **`tests/`**: Houses automated tests that are not co-located with source files. This primarily includes End-to-End (E2E) tests and broader Integration tests. It may also contain global mock setups and test utility configurations. Unit tests are co-located within the `src/` directory alongside the modules they test.

---

### 4. Deep Dive into `src/` Directory Structure

The `src/` directory is organized to promote modularity, separation of concerns, and ease of navigation.

* **`main.tsx`**: The main entry point of the application. Initializes React, sets up routing, providers (e.g., theme, state), and renders the root `App` component.
* **`App.tsx`**: The root React component, typically defining the main application layout structure and global routes.
* **`vite-env.d.ts`**: TypeScript declarations for Vite-specific environment variables.

* **`assets/`**:
  * **Purpose:** Stores static assets like images (SVG, PNG), local font files, or other media that are imported and used directly by components or CSS.
  * **Example:** `src/assets/images/logo.svg`

* **`components/`**:
  * **Purpose:** Contains reusable UI components.
  * **`ui/`**: This directory will house the components added from **`shadcn/ui`**. Since `shadcn/ui` involves copying component code, these become part of our project directly and can be customized.
    * **Example:** `src/components/ui/button.tsx`, `src/components/ui/card.tsx`
  * **`layout/`**: Structural components defining the overall page layouts.
    * **Example:** `src/components/layout/Navbar.tsx`, `src/components/layout/Sidebar.tsx`, `src/components/layout/PageWrapper.tsx`
  * **`shared/` (or directly under `components/`)**: Truly global, reusable UI components developed specifically for StrongLog that don't fit into `shadcn/ui`'s offerings or specific layout structures. These are application-agnostic building blocks.
    * **Example:** `src/components/shared/ExerciseIcon.tsx`, `src/components/shared/ConfirmationModal.tsx`

* **`config/`**:
  * **Purpose:** Application-wide configuration, constants, and access to environment variables.
  * **Example:** `src/config/index.ts` (exporting constants like API base URLs (for sync), default settings, feature flags).

* **`features/`**:
  * **Purpose:** This is the core organizational structure for the application's business logic and UI, organized by domain or epic. Each feature module is self-contained or has clearly defined dependencies on other features or global services/state. This promotes modularity and makes it easier for developers (and AI agents) to work on specific parts of the application without unintended side effects.
  * **General Structure within a Feature (e.g., `src/features/workout-logging/`):**
    * `components/`: UI components specific to this feature (e.g., `SetInputRow.tsx`, `ExerciseLogger.tsx`).
    * `hooks/`: Custom React hooks specific to this feature's logic.
    * `pages/` or `views/`: Page-level components that are rendered by routes associated with this feature (e.g., `ActiveWorkoutPage.tsx`, `WorkoutHistoryDetailPage.tsx`).
    * `services/` or `lib/`: Feature-specific business logic, utility functions, or data transformation logic not fitting into global services.
    * `types.ts` or `index.types.ts`: TypeScript interfaces and types specific to this feature.
    * `index.ts`: Barrel file exporting the public API of the feature module (e.g., main page components, key hooks or services).
  * **Planned Feature Folders (aligned with Epics):**
    * `auth/`: User authentication for optional sync (login, registration components/logic).
    * `core-pwa/`: PWA-specific setup, service worker custom logic (if `vite-plugin-pwa` defaults aren't enough), install prompts.
    * `exercises/`: Exercise definition, custom exercise creation, exercise list/browser.
    * `logging/`: Workout logging UI and logic for standard and advanced set types (AMRAPs, Pyramids, Dropsets), integrated timer UI.
    * `programs/`: Program definition, management, active program tracking, adaptive schedule display (UI for FRY).
    * `rules/`: Progression rule definition, management, library (UI for FRX).
    * `goals/`: Goal definition, management, progress visualization (UI for FRZ).
    * `dashboard/`: Main dashboard components, "Today's Focus," analytics charts and views (FR6).
    * `data-management/`: UI and client logic for data import (StrongLifts), data export, and initiating data deletion.
    * `settings/`: User settings UI (units, theme, sync preferences, default rest timer).

* **`hooks/` (global):**
  * **Purpose:** Contains globally reusable custom React hooks that are not specific to a single feature (e.g., `useDebounce.ts`, `useLocalStorage.ts`, `useNetworkStatus.ts`).

* **`lib/` (global):**
  * **Purpose:** Global utility functions, helper modules, or libraries that are not React-specific (e.g., date formatting, string manipulation, complex calculations not part of an engine).

* **`pages/` (alternative to `features/**/pages/`):**
  * **Purpose:** If not co-locating pages within feature directories, this top-level directory would contain all page components mapped to routes. For StrongLog's complexity, **co-locating pages within `features/` is generally recommended** for better modularity. If this folder exists, it should be for very generic pages like a global `NotFoundPage.tsx`.

* **`services/`**:
  * **Purpose:** Contains global, cross-cutting services and the core logic for client-side engines and data persistence.
  * **`data/db.ts`**: Defines the Dexie.js database instance, schema, versioning, and potentially exports common data access functions or typed table instances. Could also contain Data Access Object (DAO) or repository pattern implementations if needed for more complex query abstraction.
  * **`engines/`**: Houses the implementation for FRX, FRY, and FRZ.
    * `frx.worker.ts`, `fry.worker.ts`, `frz.worker.ts`: Entry point scripts for each Shared Web Worker. These will set up the engine logic (potentially importing from subfolders) and expose APIs via Comlink.
    * `frx/`, `fry/`, `frz/`: Subdirectories containing specific logic, utilities, type definitions, and algorithms for each respective engine (e.g., `frx/frxRuleEvaluator.ts`, `fry/fryAdaptiveScheduler.ts`, `frz/frzE1RMCalculator.ts`).
    * `comlink.setup.ts`: Could centralize Comlink setup, exporting wrapped worker instances for use by the main thread application logic.
    * `engine.types.ts`: Shared TypeScript types used by or exchanged with the engines. Zod schemas for engine inputs/outputs might be defined/referenced here.
  * **`sync/`**: Contains the client-side logic for the optional data synchronization service, including interacting with the backend REST API, managing offline queues (if more complex than simple "last write wins" needs arise post-V1.0), and handling data merging.

* **`state/`**:
  * **Purpose:** Global state management using Zustand. Contains store definitions, actions, and selectors.
  * **Example:** `src/state/uiStore.ts` (for UI theme, global loading states), `src/state/userSettingsStore.ts`. Note that data directly from Dexie.js will be primarily accessed reactively via `useLiveQuery` in components, so Zustand stores will focus on non-persistent or transient global state.

* **`styles/`**:
  * **Purpose:** Global CSS styles, entry point for Tailwind CSS (e.g., `index.css` or `global.css` importing Tailwind base, components, utilities), global style variables or theme overrides not handled by Tailwind config.

* **`types/` (global):**
  * **Purpose:** Globally shared TypeScript interfaces, type definitions, and enums that are used across multiple features or services and are not specific to a single module. Zod schemas for global types could also be defined/referenced here.

* **Unit Tests Co-location:** Unit tests (using Vitest and React Testing Library) will be placed in the same directory as the source file they are testing. For example, a component `src/features/logging/components/TimerDisplay.tsx` would have its unit test at `src/features/logging/components/TimerDisplay.test.tsx`. This improves discoverability and makes it easier to test modules in isolation. Test files will typically be named `*.test.ts(x)` or `*.spec.ts(x)`.

---

### 5. `tests/` Directory Structure (Revised)

* **Purpose:** Contains automated tests that are not unit tests co-located within `src/`.
* **`e2e/`**: End-to-end tests written using Playwright, simulating full user journeys through the deployed PWA.
  * **Example:** `tests/e2e/full-workout-cycle.e2e.spec.ts`
* **`integration/`**: Integration tests written using Vitest. These tests verify the interactions between several parts of the application, such as a feature's UI components interacting with its local services, state, and Dexie.js, or interactions between different services. These are broader than unit tests but do not cover the full application stack like E2E tests. They might still mock external dependencies like Web Workers or backend APIs.
  * **Example:** `tests/integration/features/programs/ProgramProgression.integration.test.ts`
* **`mocks/`**: Global mocks used across different types of tests (e.g., mock implementations for browser APIs not available in Node for Vitest, mock worker implementations, or shared mock data).
* **`setup/`**: Configuration and setup files for the test environments (e.g., `vitest.setup.ts` for global Vitest configurations, `vitest.config.ts` if separate from `vite.config.ts`, RTL custom render setup).

---

### 6. Root Directory Files

Key configuration files at the root include:

* **`index.html`**: The main HTML entry point for the Vite application.
* **`vite.config.ts`**: Configuration for Vite, including `vite-plugin-pwa` setup, worker options, and build settings.
* **`tsconfig.json` / `tsconfig.node.json`**: TypeScript compiler options.
* **`package.json`**: Project dependencies, scripts (dev, build, test, lint, format).
* **`.eslintrc.cjs`, `.prettierrc.cjs`**: Configurations for ESLint (linting) and Prettier (code formatting).
* **`tailwind.config.cjs`, `postcss.config.cjs`**: Configuration for Tailwind CSS.

---

### 7. File Naming Conventions (Brief Overview)

* **Components (React):** `PascalCase.tsx` (e.g., `WorkoutCard.tsx`)
* **Types/Interfaces:** `PascalCase` (often in `types.ts` or `*.types.ts`)
* **Hooks:** `useCamelCase.ts` (e.g., `useTimer.ts`)
* **Services/Utilities/Modules:** `camelCase.ts` or `kebab-case.ts`
* **Unit Test Files:** `*.test.tsx` or `*.test.ts` (co-located with the source file, e.g., `WorkoutCard.test.tsx`).
* **Integration Test Files:** `*.integration.test.tsx` or `*.integration.test.ts`.
* **E2E Test Files:** `*.e2e.spec.ts` or `*.e2e.test.ts`.

*(Full details on naming, casing, and coding style will be in `docs/coding-standards.md`)*

---

### 8. Modularity and AI Agent Optimization

This proposed structure emphasizes:

* **High Cohesion, Low Coupling:** Feature folders group related code, making modules self-contained. Global services/hooks/types are clearly separated.
* **Clear Separation of Concerns:** UI (components, pages), state (Zustand, Dexie via `useLiveQuery`), services (data access, engines, sync), and configuration are in distinct, predictable locations.
* **Predictability:** A consistent structure within feature folders makes it easier to locate specific pieces of code. The co-location of unit tests further enhances predictability for AI agents when looking for tests related to a specific module.
* **Well-Defined Interfaces:** TypeScript usage, barrel files (`index.ts`) for exporting from modules, and Comlink for worker APIs create clear boundaries.

These characteristics are highly beneficial for AI development agents, as they allow the agent to:

* Understand the codebase more easily by parsing a logical and predictable structure.
* Localize changes within specific feature modules, reducing the risk of unintended side effects.
* Generate code that adheres to existing structural patterns.
* More easily identify where new components, services, or types should be placed.
